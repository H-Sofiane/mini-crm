{% extends "contacts/base.html" %}

{% block content %}

<a href="{% url 'contact_create' %}" class="btn btn-dark mb-3" style="border-radius: 0;">Ajouter un contact</a>

<div class="container mt-4">
    <h2>Liste des contacts</h2>

    <form method="get" class="mb-3">
    <input type="text" name="q" class="form-control"
           placeholder="Rechercher un contact..."
           value="{{ request.GET.q }}">
    </form>

    <form method="get" class="mb-3" style="max-width: 300px;">
        <select name="entreprise" class="form-select" onchange="this.form.submit()">
            <option value="">Toutes les entreprises</option>
            {% for e in entreprises %}
                <option value="{{ e.id }}" 
                    {% if request.GET.entreprise == e.id|stringformat:"s" %}selected{% endif %}>
                    {{ e.nom }}
                </option>
            {% endfor %}
        </select>
    </form>


    <table class="table table-striped table-hover mt-3">
        <thead>
            <tr>
                <th>Photo</th>
                <th>
                    <a href="?sort=nom">Nom ↑</a>
                    <a href="?sort=-nom">↓</a>
                </th>

                <th>
                    <a href="?sort=email">Email ↑</a>
                    <a href="?sort=-email">↓</a>
                </th>

                <th>
                    <a href="?sort=entreprise__nom">Entreprise ↑</a>
                    <a href="?sort=-entreprise__nom">↓</a>
                </th>
                <th>Téléphone</th>
                <th class="text-end">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for contact in page_obj %}
            <tr>
                <td>
                    {% if contact.photo %}
                        <img src="{{ contact.photo.url }}" alt="Photo" class="rounded" width="40" height="40">
                    {% else %}
                        <span class="text-muted">—</span>
                    {% endif %}
                </td>

                <td>{{ contact.prenom }} {{ contact.nom }}</td>

                <td>
                    {% if contact.entreprise %}
                        <span class="badge bg-primary">{{ contact.entreprise.nom }}</span>
                    {% else %}
                        <span class="badge bg-secondary">Aucune</span>
                    {% endif %}
                </td>


                <td>{{ contact.email }}</td>
                <td>
                    {% if contact.telephone %}
                        {{ contact.telephone }}
                    {% else %}
                        <span class="badge bg-warning text-dark">Aucun</span>
                    {% endif %}
                </td>


                <td class="text-end">
                    <a href="{% url 'contact_detail' contact.id %}" class="btn btn-sm btn-primary">Voir</a>
                    <a href="{% url 'contact_update' contact.id %}" class="btn btn-sm btn-warning">Modifier</a>
                    <a href="{% url 'contact_delete' contact.id %}" class="btn btn-sm btn-danger">Supprimer</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <nav>
    <ul class="pagination justify-content-center">
        {% if page_obj.has_previous %}
        <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Précédent</a>
        </li>
        {% endif %}

        <li class="page-item active">
            <span class="page-link">
                Page {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
            </span>
        </li>

        {% if page_obj.has_next %}
        <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.next_page_number }}">Suivant</a>
        </li>
        {% endif %}
    </ul>
</nav>
</div>

{% endblock %}
